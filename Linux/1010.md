# Linux学习笔记

## Bash 简介

Bash（全称 Bourne Again SHell）是 Linux 和 Unix-like 系统中最常用的 Shell（命令行解释器）。简单来说，Shell 是用户与操作系统内核之间的“桥梁”——它解释你输入的命令，并执行相应的操作。

### Bash 的特点
- 它是 GNU 项目开发的，基于传统的 Bourne Shell（sh）改进版。
- 支持脚本编写（.sh 文件），包括变量、循环、条件判断等编程功能。
- 默认在大多数 Linux 发行版（如 Ubuntu、CentOS）中作为登录 Shell。

## 命令提示符

命令提示符（Command Prompt），在 Bash Shell 中称为 PS1（Primary Prompt String）。

示例：
- `sheldon@sheldon-virtual-machine:~$`
- `root@iZm5e8dsxce9ufaic7hi3uZ ~# pwd`

### 命令提示符解析
- `root`：表示用户名。
- `iZm5e8dsxce9ufaic7hi3uZ`：表示主机名。
- `~`：表示目前所在目录为家目录（root 用户的家目录是 `/root`，普通用户的家目录在 `/home` 下）。
- `#`：指示你所具有的权限（root 用户为 `#`，普通用户为 `$`）。

## 命令格式与参数

命令格式：`command parameters`（命令 参数）。

### 长短参数
- **单个参数**：`ls -a`（`a` 是英文 `all` 的缩写，表示“全部”）。
- **多个参数**：`ls -al`（全部文件 + 列表形式展示）。
- **单个长参数**：`ls --all`。
- **多个长参数**：`ls --reverse --all`。
- **长短混合参数**：`ls --all -l`。

### 参数值
- **短参数**：`command -p 10`（例如：`ssh root@121.42.11.34 -p 22`）。
- **长参数**：`command --paramters=10`（例如：`ssh root@121.42.11.34 --port=22`）。

**注意**：
- 短参数使用一个短斜杠，长参数使用两个短斜杠。
- 短参数可以连写，长参数不可以。
- 参数的执行效果与顺序无关。除了与位置有关的参数外，顺序可以打乱。

## 常用快捷键

- **上下方向键 ↑ ↓**：调取过往执行过的 Linux 命令。
- **Tab 键**：命令或参数仅需输入前几位就可以补全。
- **Ctrl + R**：用于查找使用过的命令（输入指令的一部分，会自动查找你之前输入过的指令；之后 Enter 使用该命令，Ctrl + C 退出搜索，Ctrl + G 搜索其他匹配的历史指令）。（Research，搜索输入过的命令）
- **Ctrl + L**：清除屏幕并将当前行移到页面顶部。（与输入 `clear` 指令的作用结果相似，不同的是 Ctrl + L 没有真的清除屏幕，而是相当于把之前的历史向上拉，拉出了一片空地，你可以通过鼠标滚轮向上查看历史，而 `clear` 命令则把命令行清空了，并且 `clear` 命令会留下指令历史记录，Ctrl + L 指令没有历史记录）。（Lower，拉至底部）
- **Ctrl + C**：中止当前正在执行的命令。（常用，发送 SIGINT 信号，默认发送给前台进程（用 `tcgetpgrp()` 获取进程组 ID）。进程收到信号：进程的信号处理程序（signal handler）执行，默认行为是终止进程（terminate）。）

  #### Ctrl + C 中断进程的后果
  进程执行到一半退出会有什么后果？取决于进程的“原子性”（atomicity）和状态管理。大多数命令设计为“幂等”或“检查点”，中断后系统会回滚或清理，但不是总是完美。进程退出时，内核会释放资源（如内存、文件句柄），但已完成的“副作用”可能保留。

  - **成功中断**：进程收到 SIGINT，执行清理（atexit handlers），然后退出。Shell 提示符返回。
  - **潜在风险**：数据丢失、半成品状态、资源泄漏（罕见）。

  ##### 文件修改例子详解
  - **简单重定向**：如 `cat newdata.txt > oldfile.txt`（复制中）。中断后，`oldfile.txt` 可能只有部分数据（e.g., 前半文件），因为 I/O 是流式的（stream）。系统不会“魔法”回滚——文件已打开写模式，变化持久化直到 flush。
  - **后果**：文件“半改”，需备份恢复（用 `mv oldfile.txt oldfile.txt.bak` 前跑）。
  - **编辑器如 vim**：vim 有“交换文件”（.swp），中断后重开会提示恢复。选择不保存：回到最初状态（`:q!`）。但如果已保存一次（`:w`），半改部分保留。

  ##### Ctrl + C 有时没有成功退出，可能原因？
  常见原因（按概率排序）：
  - **进程忽略 SIGINT**：程序自定义处理信号（如 `trap '' INT` 在脚本中，或 `sigaction(SIGINT, SIG_IGN)` 在 C 程序）。e.g., `dd if=/dev/zero of=file bs=1M` 默认忽略（用 Ctrl + \ 发 SIGQUIT）。
    - **解决**：用 Ctrl + \ (SIGQUIT) 或 `kill -TERM <PID>`（温和终止）。
  - **进程在系统调用中阻塞**：如等待 I/O（read/write）、sleep，或 NFS 挂起。信号排队，但进程忙时延迟响应。
    - **解决**：等几秒，或用 `kill -KILL <PID>`（强制杀，但危险——不清理）。
  - **后台/多进程**：Ctrl + C 只中断前台；如果命令 fork 子进程（如 `find / | xargs rm`），子进程可能继续。
    - **解决**：用 `pkill` 或 `jobs` 查后台，`fg` 带前台。
  - **终端问题**：远程 SSH 冻结（网络延迟），或终端模拟器 bug（e.g., VS Code 终端）。或 Shell 配置改了绑定（`stty intr ^Z`）。
    - **解决**：检查 `stty -a`（看 intr 键），或新开终端。
  - **权限/容器**：在 Docker/chroot 中，信号可能被容器隔离。
    - **解决**：进容器用 `docker exec` 或 kill 从宿主机。

- **Ctrl + U**：从光标位置剪切到行首。（Up，剪切到行首）
- **Ctrl + K**：从光标位置剪切到行尾。（Kill，剪切到行尾）
- **Ctrl + W**：剪切光标左侧的一个单词。（Word，剪切一个单词）
- **Ctrl + Y**：粘贴 Ctrl + U | K | Y 剪切的内容。（Yank，粘贴剪切的内容）
- **Ctrl + A**：光标跳到命令行的开头。（Ahead，跳回行开头）
- **Ctrl + E**：光标跳到命令行的结尾。（End，跳至行尾）
- **Ctrl + D**：关闭 Shell 会话（要清空当前输入的命令，否则执行不了）。（Delete，退出命令行）

## 常用命令

### pwd
- **全称**：Print Working Directory。
- **作用**：打印当前工作目录。

### which
- **作用**：查看命令的可执行文件所在路径。
- Linux 下，每一条命令其实都对应一个可执行程序，在终端中输入命令，按回车的时候，就是执行了对应的那个程序。`which` 命令本身对应的程序也存在于 Linux 中。
- 总的来说，一个命令就是一个可执行程序。输入命令等同于执行一个可执行程序，命令对应的可执行程序都放在 `/usr/bin` 中，可以使用 `ls` 查看所有命令。

### ls
- **作用**：列出文件和目录，它是 Linux 最常用的命令之一。（list）

#### 常用参数
- **-a**：显示所有文件和目录包括隐藏的（隐藏文件用 `.` 开头）。（all）
  - **为何隐藏文件**：许多文件是用户/系统配置（如 `.git/`、`.env`），含敏感信息（密码、API 密钥）。隐藏避免意外泄露或编辑。普通用户无需碰系统/临时文件（如 `.cache/`、`.DS_Store`）。隐藏减少“乱动”风险，保持目录整洁。像“点缀”，标记“辅助”文件（config、temp、backup）。可见文件是“主角”，隐藏是“配角”。大目录（如 `/tmp`）有海量临时 `.pid` 文件，隐藏后 `ls` 更快、更易读。
- **-l**：显示详细列表（long format）。
  - 详细列出文件/目录的属性，包括：文件类型和权限、硬链接数、所有者和组、文件大小、修改时间、文件名。
  - 默认 `ls` 只给名字（如“file.txt”），`-l` 像“文件身份证”，帮你快速诊断（e.g., 文件可读？谁拥有？多大？）。
  - 示例：
    ```
    sheldon@sheldon-virtual-machine:/usr/bin$ ls -l
    总计 232632
    -rwxr-xr-x 1 root root       51632  2月  8  2022 '['
    -rwxr-xr-x 1 root root       35344  3月  7  2024  aa-enabled
    -rwxr-xr-x 1 root root       35344  3月  7  2024  aa-exec
    -rwxr-xr-x 1 root root       31248  3月  7  2024  aa-features-abi
    总计 232632
    ```
  - **含义**：目录总占用大小（total），单位是“块”（通常 4KB/块）。这里 232632 块 ≈ 906 MB（232632 × 4KB）。它计算所有文件/子目录的元数据和内容占用。
- **-h**：适合人类阅读的（human readable）。主要就是把文件大小由字节数转换成人类熟悉的单位（KB、MB 等）。
- **-t**：按文件最近一次修改时间排序（time）。从上至下为最晚修改的文件到最早修改的文件。
- **-i**：显示文件的 inode（inode 是文件内容的标识）。

#### Inode 是什么？
- **全称**：Index Node（索引节点）。
  - **Index**：索引（像文件系统的“目录索引”）。
  - **Node**：节点（数据结构节点）。
- **本质**：inode 是文件系统（e.g., ext4、xfs）中的一个元数据结构（metadata structure），用于存储文件的属性信息，但不存储文件实际内容（数据块）。每个文件/目录在文件系统上都有一个唯一的 inode。

### cd
- **全称**：Change Directory。
- **作用**：切换目录。
- **常用用法**：
  - `cd /`：跳转到根目录。
  - `cd ~`：跳转到家目录。
  - `cd ..`：跳转到上级目录。
  - `cd ./home`：跳转到当前目录的 home 目录下。
  - `cd /home/lion`：跳转到根目录下的 home 目录下的 lion 目录。
  - `cd`：不添加任何参数，也是回到家目录。

### du
- **全称**：Disk Usage（磁盘使用量）。
- **作用**：列举目录大小信息。在一个目录下使用 `du` 是列出该目录下的目录的大小，看不到该目录下的文件大小。文件大小会被打包到总计大小中，但不会列出。如果想看到文件大小需要加 `-a` 参数（all）会列出所有目录以及文件的大小。

#### 常用参数
- **-h**：适合人类阅读的。
- **-a**：同时列举出目录下文件的大小信息。
- **-s**：只显示总计大小，不显示具体信息。

### cat
- **全称**：Concatenate（连接）。
  - **Concatenate**：连接/串联（英文词，源自拉丁文“con-”（一起）+ “tenere”（持有），意思是“把多个东西连成一串”）。
  - **为什么叫这个**？cat 的设计初衷是连接多个文件的内容，并输出到标准输出（stdout）。早期 Unix 中，你可以用 `cat file1 file2 > output` 把两个文件“拼接”成一个。单文件时，它就“连接”文件内容到屏幕（输出显示）。
  - **助记技巧**：C-A-T = "Concatenate And Type"（连接并打印）——简单记成“连接文件输出”。
- **核心作用**：读取文件内容，并直接输出到终端（或重定向到其他地方）。它不解释内容，只是“盲读盲输”——适合文本文件（如日志、脚本）。
- **常见用法**：
  - `cat file.txt`：显示文件内容。
  - `cat file1 file2`：连接多个文件输出。
  - `cat > newfile`：从输入创建新文件（Ctrl+D 结束）。
  - **选项**：`-n`（加行号）、`-E`（显示行尾 `$`）。
- **为什么“列出”**？单文件时像“列印”（print），但本质是“dump”内容。

#### 如果用 cat 显示非文本文件，会看到什么？
- **关键点**：cat 不区分文件类型——它无脑输出二进制数据（raw bytes），不管是文本还是可执行程序。结果：屏幕会显示乱码（garbled text），因为非文本文件含二进制码（0-255 字节），包括不可打印字符（control codes，如换行、颜色码）、十六进制数据等。
- **为什么乱码**？终端假设输入是 ASCII/UTF-8 文本（可打印字符），二进制会触发奇怪效果：光标乱跳、颜色闪、甚至终端卡顿。不是“错误”，只是人类眼不适。
- **后果**：无害（文件不变），但不实用——用 `hexdump` 或 `xxd` 看二进制更好。
- **具体看到什么**？取决于文件：
  - 可执行程序（e.g., `/bin/ls`）：ELF 二进制头 + 机器码，看起来像 `^@ ^A ^B`（控制符）+ 随机字母/数字字符串。
  - 图片（e.g., PNG/JPG）：二进制头（‰PNG 或 JFIF）+ 像素数据，显示为乱码 + 可能的部分可读字符串（如元数据）。
  - 压缩文件（e.g., ZIP）：头信息 + 压缩块，纯乱码。

### less
- **本质**：less 是一个分页查看器（pager），用于交互式浏览文件内容。它一次只加载一屏内容，支持向上/向下滚动、搜索、跳转等操作，让你像翻书一样“少量阅读”（hence the name）。
- **作用**：
  - 显示文件内容，但不一次性全倒到终端（避免刷屏）。
  - 适合大文件：e.g., `less /var/log/syslog`（系统日志，可能几 MB）。
- **交互命令**：
  - 按 `q` 退出。
  - Space：下翻页。
  - `b`：上翻页。
  - `/` + 关键词：搜索。
  - `g`：跳首。
  - `G`：跳尾。

#### less 和 cat 的区别是什么？
- **核心区别**：cat 是“全速输出”（dump everything），适合小文件或连接；less 是“分页交互”（browse interactively），适合大文件或需要导航的场景。cat 像“倒书到桌上”，less 像“手持书本翻阅”。

#### 快捷操作
- **空格键**：前进一页（一个屏幕）。
- **b 键**：后退一页。（back）
- **回车键**：前进一行。
- **y 键**：后退一行。（Yank）
- **上下键**：回退或前进一行。
- **d 键**：前进半页。（down）
- **u 键**：后退半页。（up）
- **q 键**：停止读取文件，中止 less 命令。（quit）
- **= 键**：显示当前页面的内容是文件中的第几行到第几行以及一些其它关于本页内容的详细信息。（Equals）
- **h 键**：显示帮助文档。（help）
- **/ 键**：进入搜索模式后，按 `n` 键跳到一个符合项目，按 `N` 键跳到上一个符合项目，同时也可以输入正则表达式匹配。

### head
- **作用**：显示文件的开头几行（默认是 10 行）。
- **参数**：
  - **-n**：指定行数，例如 `head cloud-init.log -n 2`。

### tail
- **作用**：显示文件的结尾几行（默认是 10 行）。
- **参数**：
  - **-n**：指定行数，例如 `tail cloud-init.log -n 2`。
  - **-f**：会每过 1 秒检查下文件是否有更新内容，也可以用 `-s` 参数指定间隔时间，例如 `tail -f -s 4 xxx.log`。

### touch
- **作用**：创建一个文件。
- 示例：`touch new_file`。

### mkdir
- **作用**：创建一个目录。
- 示例：`mkdir new_folder`。
- **常用参数**：
  - **-p**：递归的创建目录结构，例如 `mkdir -p one/two/three`。

### cp
- **作用**：拷贝文件和目录。
- 示例：
  - `cp file file_copy`：file 是目标文件，file_copy 是拷贝出来的文件。
  - `cp file one`：把 file 文件拷贝到 one 目录下，并且文件名依然为 file。
  - `cp file one/file_copy`：把 file 文件拷贝到 one 目录下，文件名为 file_copy。
  - `cp *.txt folder`：把当前目录下所有 txt 文件拷贝到 folder 目录下。
- **常用参数**：
  - **-r**：递归的拷贝，常用来拷贝一整个目录。

### mv
- **作用**：移动（重命名）文件或目录，与 `cp` 命令用法相似。
- 示例：
  - `mv file one`：将 file 文件移动到 one 目录下。
  - `mv new_folder one`：将 new_folder 文件夹移动到 one 目录下。
  - `mv *.txt folder`：把当前目录下所有 txt 文件移动到 folder 目录下。
  - `mv file new_file`：file 文件重命名为 new_file。

### rm
- **作用**：删除文件和目录，由于 Linux 下没有回收站，一旦删除非常难恢复，因此需要谨慎操作。
- 示例：
  - `rm new_file`：删除 new_file 文件。
  - `rm f1 f2 f3`：同时删除 f1 f2 f3 3 个文件。
- **常用参数**：
  - **-i**：向用户确认是否删除。
  - **-f**：文件强制删除。
  - **-r**：递归删除文件夹，著名的删除操作 `rm -rf`。