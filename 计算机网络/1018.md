# 网络协议学习文档

## 第一部分：TCP/IP 四层结构

### 各层常用协议

**应用层：**

- HTTP/HTTPS
- FTP（文件传输协议，用于文件上传和下载）
- SMTP（简单邮件传输协议，用于发送邮件）
- DNS（域名系统协议，用于域名解析到 IP 地址）
- SSH（安全壳协议，用于安全的远程登录和文件传输）

**传输层：**

- TCP
- UDP

**网络层：**

- IP
- ICMP

------

## 第二部分：IP 协议详解

### 1. IP 协议基础

IP 是网络层的基础协议，提供**无连接的、不可靠的**数据报传输服务。它于 1981 年由 RFC 791 定义 IPv4，并在 1998 年由 RFC 2460 定义 IPv6。IP 负责将上层数据（如 TCP/UDP 段）封装成 IP 数据报，添加源/目的 IP 地址，并交给链路层传输。

### 2. IP 的基本架构和模型

#### 版本

**IPv4：** 32 位地址（约 43 亿地址），格式如 192.168.1.1。面临地址耗尽问题。

**IPv6：** 128 位地址（约 3.4×10^38 个），格式如 2001:db8::1。支持自动配置和更好的安全性。

#### 数据报结构

IPv4 头部 20 字节 + 数据；IPv6 头部 40 字节

- **版本**：4 位（IPv4=4，IPv6=6）
- **头部长度/流量类**：IPv4 有 TTL（Time to Live，跳数限制，防环路）；IPv6 有流标签（支持 QoS）
- **源/目的地址**：核心标识
- **协议字段**：标识上层协议（如 TCP=6，UDP=17）
- **校验和**：仅头部校验（IPv4），数据依赖上层
- **分片**：IP 数据报太大时分片（Fragmentation），接收方重组。但 IPv6 不允许分片（由发送方处理）

### 3. IP 的工作原理

IP 使用**路由表**（Routing Table）转发数据报：

1. 发送方封装数据到 IP 数据报，添加源/目的 IP
2. 路由器检查目的 IP，根据路由表选择下一跳（Next Hop），转发数据报
3. TTL 递减，若为 0 则丢弃
4. 到达目的主机后，解封装上交传输层

IPv4 和 IPv6 的迁移使用双栈（Dual Stack）或隧道（如 6to4）。

#### 示例 IP 数据报流程（简化）

主机 A (192.168.1.1) 发送到主机 B (10.0.0.1)：

- 封装：IP 头部 (源=192.168.1.1, 目的=10.0.0.1, TTL=64) + TCP 数据
- 路由器转发，TTL 减 1
- 到达 B，B 检查地址，处理数据

### 4. IP 的优缺点

**优点：**

- 简单高效：无连接，低开销
- 全球互联：IP 地址是互联网的"邮政编码"
- 扩展性：IPv6 解决地址短缺，支持移动性和安全（IPsec 集成）

**缺点：**

- 不可靠：无确认、重传或顺序保证
- 安全弱：IPv4 无内置加密（需 IPsec）；地址耗尽需 NAT（Network Address Translation）
- 路由复杂：大网络中路由表膨胀

------

## 第三部分：ICMP 协议详解

### 1. ICMP 基础

ICMP（Internet Control Message Protocol，互联网控制消息协议）是 IP 的辅助协议，用于报告错误和诊断网络问题。

### 2. ICMP 的基本架构和模型

- **类型**：查询消息（如 Echo Request/Reply，用于 ping）和错误消息（如 Destination Unreachable）
- **消息结构**：类型（8 位）+ 代码（8 位）+ 校验和 + 数据（包含原 IP 头部）

### 3. ICMP 的工作原理

ICMP 由 IP 层生成/发送，不直接由应用层使用。

**Ping：** 发送 Echo Request (类型 8)，接收 Echo Reply (类型 0)，测量 RTT（Round-Trip Time）

**错误报告：** 如 TTL 超时时，路由器发送 Time Exceeded (类型 11)

#### 常见 ICMP 消息表

| 类型 | 代码 | 描述                    | 示例用途              |
| ---- | ---- | ----------------------- | --------------------- |
| 0    | 0    | Echo Reply              | Ping 响应             |
| 8    | 0    | Echo Request            | Ping 请求             |
| 3    | 0-15 | Destination Unreachable | 主机/端口不可达       |
| 11   | 0    | Time Exceeded           | TTL 超时 (traceroute) |
| 5    | 0-3  | Redirect                | 路由优化              |

### 4. ICMP 的优缺点

**优点：** 诊断强大，帮助故障排除

**缺点：** 易被滥用（如 DDoS 放大攻击），防火墙常限制

### 5. 实际应用

- ping 8.8.8.8 发送 ICMP Echo
- traceroute 使用 ICMP Time Exceeded 追踪路径

------

## 第四部分：ARP 协议详解

### 1. ARP 基础

ARP（Address Resolution Protocol，地址解析协议）用于将 IP 地址映射到 MAC 地址（局域网内）。RFC 826 定义，基于广播。

### 2. ARP 的基本工作原理

- **请求**：主机广播 ARP Request ("谁有 IP 192.168.1.1？")
- **响应**：目标主机单播 ARP Reply ("我是 MAC aa:bb:cc")
- **缓存**：ARP 表存储映射，避免重复广播

### 3. ARP 的优缺点

**优点：** 简单，实现 LAN 通信

**缺点：** 安全风险（ARP 欺骗），IPv6 用 NDP（Neighbor Discovery Protocol）取代

------

## 第五部分：IPv4 协议基础

### 1. 定义

**IPv4（Internet Protocol version 4）** 是网络层协议，用于在网络中标识主机并实现数据包的传输。

每个 IPv4 地址是 **32 位二进制数**，通常用四段十进制数表示（0–255），如：`192.168.1.10`

### 2. IPv4 地址结构

IPv4 地址由两部分组成：

```
[ 网络号 (Network ID) | 主机号 (Host ID) ]
```

- **网络号**：标识主机属于哪个网络（类似"哪座城市"）
- **主机号**：标识该网络中的哪台设备（类似"哪栋楼"）

不同网络号之间需要路由器通信。

### 3. IPv4 地址分类（旧方式）

早期 IPv4 地址分为 A/B/C/D/E 类：

| 类别 | 网络号位数 | 默认掩码      | 可用主机数 | 示例        |
| ---- | ---------- | ------------- | ---------- | ----------- |
| A    | 8          | 255.0.0.0     | ~1600万    | 10.0.0.1    |
| B    | 16         | 255.255.0.0   | 65534      | 172.16.0.1  |
| C    | 24         | 255.255.255.0 | 254        | 192.168.1.1 |
| D    | 多播       | —             | —          | 224.0.0.1   |
| E    | 保留       | —             | —          | 240.0.0.1   |

但这种"分类地址"已被淘汰，由 **CIDR（无类别域间路由）** 取代。

### 4. 私有地址与公有地址

为缓解 IPv4 地址不足，定义了私有网段（不可在公网路由）：

| 网段           | 范围                          | 用途       |
| -------------- | ----------------------------- | ---------- |
| 10.0.0.0/8     | 10.0.0.0 – 10.255.255.255     | 大型内部网 |
| 172.16.0.0/12  | 172.16.0.0 – 172.31.255.255   | 中型企业   |
| 192.168.0.0/16 | 192.168.0.0 – 192.168.255.255 | 家庭局域网 |

这些私有地址访问互联网时通常通过 **NAT（网络地址转换）** 出口映射到公有 IP。

### 5. IPv4 的局限性

- 地址总量仅约 43 亿个
- 地址分配不均
- 网络广播导致性能下降
- 路由表庞大
- 安全性、自动配置能力有限

于是 IPv6 诞生。

------

## 第六部分：IPv6 协议基础

### 1. 定义

**IPv6（Internet Protocol version 6）** 是下一代互联网协议。

使用 **128 位地址**，理论上可分配的地址数量是：`2^128 ≈ 3.4 × 10^38`

完全解决了 IPv4 地址耗尽问题。

### 2. IPv6 地址表示

采用十六进制表示，分为 8 组，每组 16 位，用冒号分隔：

```
2001:0db8:85a3:0000:0000:8a2e:0370:7334
```

可以省略规则：

- 前导零可省略
- 连续全 0 段可用 `::` 表示（只能出现一次）

例：`2001:db8::8a2e:370:7334`

### 3. IPv6 特点

| 功能         | IPv6 改进                            |
| ------------ | ------------------------------------ |
| 地址空间     | 从 32 位 → 128 位                    |
| 首部结构     | 固定 40 字节，简化字段，提高路由效率 |
| 分片         | 仅源端可分片，路由器不分片           |
| 校验和       | 去掉头部校验和，减少计算量           |
| 地址自动配置 | 支持 SLAAC（无状态自动配置）         |
| 安全性       | 内置支持 IPsec                       |
| 替代 ARP     | 使用 ICMPv6 的"邻居发现协议（ND）"   |
| 广播         | 取消广播，改用多播和任播             |

### 4. IPv6 地址类型

| 类型         | 前缀                    | 说明                       |
| ------------ | ----------------------- | -------------------------- |
| 单播地址     | 各种形式（2000::/3 等） | 对应单一接口               |
| 多播地址     | ff00::/8                | 一对多通信                 |
| 任播地址     | —                       | 一对最近的某一个节点       |
| 链路本地地址 | fe80::/10               | 仅局部网络可见（自动生成） |
| 环回地址     | ::1                     | 本机自身                   |
| 未指定地址   | ::                      | 尚未分配时使用             |

------

## 第七部分：子网与子网掩码（IPv4 重点）

### 1. 子网（Subnet）

是把一个大的网络再划分为多个更小的网络。

- 每个子网有独立的网络号
- 在同一子网内的主机可以**直接通信**
- 不同子网之间通信必须**经过路由器**

子网划分有助于：

- 减少广播范围
- 提高安全性和管理效率
- 合理利用 IP 地址

### 2. 子网掩码（Subnet Mask）

用于划分 IP 地址中的"网络号"和"主机号"边界。

写法与 IP 一样（点分十进制），例如：`255.255.255.0`

对应二进制：`11111111.11111111.11111111.00000000`

- 连续的 1 → 网络号部分
- 连续的 0 → 主机号部分

### 3. 判断网络号的计算

通过按位与（AND）运算：

```
IP 地址:   192.168.1.10
子网掩码: 255.255.255.0
------------------------
网络号:    192.168.1.0
```

所以：

- 网络号：192.168.1.0
- 主机号：10

### 4. CIDR（无类别域间路由）

用"斜杠 + 位数"表示网络号长度。

例：

- `192.168.1.10/24` → 掩码 255.255.255.0
- `192.168.1.10/16` → 掩码 255.255.0.0

位数越大，网络越"细"，可用主机越少。

### 5. 可用主机数计算

公式：

```
主机位数 = 32 - 网络位数
可用主机数 = 2^(主机位数) - 2
```

（减去网络地址和广播地址）

例：

- /24 → 主机位 8 → 可用 254 台
- /25 → 主机位 7 → 可用 126 台

### 6. 子网划分示例

假设：`网络：192.168.1.0/24`

划分为 4 个子网 → 需要借 2 位（2^2 = 4 个子网）

新掩码：/26 = 255.255.255.192

| 子网号           | 地址范围          | 广播地址      |
| ---------------- | ----------------- | ------------- |
| 192.168.1.0/26   | 192.168.1.0–63    | 192.168.1.63  |
| 192.168.1.64/26  | 192.168.1.64–127  | 192.168.1.127 |
| 192.168.1.128/26 | 192.168.1.128–191 | 192.168.1.191 |
| 192.168.1.192/26 | 192.168.1.192–255 | 192.168.1.255 |

### 7. 网络号 vs 主机号

| 项目       | 网络号                           | 主机号               |
| ---------- | -------------------------------- | -------------------- |
| 含义       | 表示属于哪个子网                 | 表示子网中的具体主机 |
| 相同网络号 | 可直接通信                       | —                    |
| 不同网络号 | 需经路由转发                     | —                    |
| 特殊值     | 全 0 = 网络地址，全 1 = 广播地址 | —                    |

------

## 第八部分：IPv4 / IPv6 / 子网核心对比

| 特性         | IPv4                        | IPv6                     |
| ------------ | --------------------------- | ------------------------ |
| 地址长度     | 32 位                       | 128 位                   |
| 地址格式     | 十进制点分四段              | 十六进制冒号分八段       |
| 地址总数     | 约 43 亿                    | 几乎无限                 |
| 子网划分     | 使用子网掩码 / CIDR         | 使用前缀长度（/64 常见） |
| 地址配置     | 手动 / DHCP                 | SLAAC / DHCPv6           |
| 广播         | 有                          | 无（用多播代替）         |
| ARP          | 有                          | 无，用邻居发现（ND）     |
| 分片         | 由路由器执行                | 仅源主机分片             |
| 校验和       | 有（头部）                  | 无（依赖上层）           |
| 常见私有网段 | 10.x / 172.16.x / 192.168.x | 使用 ULA（fc00::/7）     |
| 安全         | 依赖额外协议（IPsec 可选）  | 内置支持 IPsec           |

### 核心要点总结

- **IPv4**：32 位地址，用子网掩码划分网络号与主机号
- **IPv6**：128 位地址，结构更简洁、安全性更强、支持自动配置
- **子网**：把大网络划分成多个小网络
- **子网掩码**：定义网络号与主机号的分界线
- **CIDR**：用 `/n` 表示网络位数，是现代网络的通用写法

------

## 第九部分：NAT（网络地址转换）

### 1. 为什么需要 NAT

#### IPv4 地址不够用

IPv4 地址是 **32 位**，也就是：

最大可分配地址数 = 2³² ≈ 42 亿个。

但全球联网设备（电脑、手机、IoT、服务器等）早已超过这个数。

于是出现了问题：

如果每个设备都要一个全球唯一的 IP，那 IPv4 肯定不够分配。

为了解决"地址枯竭"的问题，NAT 技术应运而生。

### 2. NAT 的基本思想

**NAT 的核心思想：**

局域网（LAN）里的设备使用**私有 IP 地址**，访问外部网络时，通过 **NAT 设备（通常是路由器）**，临时转换为一个 **公网 IP 地址**。

这样：

- 内网成千上万台机器可以共用 **一个公网 IP**
- 节省了公网地址资源

### 3. 私有地址与公网地址

NAT 建立在 "私有 IP" 与 "公网 IP" 的区分之上。

| 类别     | 地址范围                      | 是否能直接访问互联网 | 常见用途             |
| -------- | ----------------------------- | -------------------- | -------------------- |
| 公网地址 | 除下列私网地址外的全部        | ✅ 可以               | 服务器、网关、互联网 |
| 私有地址 | 10.0.0.0 ~ 10.255.255.255     | ❌ 不行               | 公司内网、家庭局域网 |
|          | 172.16.0.0 ~ 172.31.255.255   | ❌ 不行               |                      |
|          | 192.168.0.0 ~ 192.168.255.255 | ❌ 不行               |                      |

例如你家 Wi-Fi 分配的地址通常是：`192.168.1.10`

这就是私有地址，**无法直接访问互联网**，因为互联网路由器会丢弃所有源地址为私网地址的数据包。

### 4. NAT 的工作原理

假设你家里有三台设备：

| 设备 | 私有 IP     | 公网 IP（路由器） |
| ---- | ----------- | ----------------- |
| 电脑 | 192.168.1.2 | 203.0.113.5       |
| 手机 | 192.168.1.3 | 203.0.113.5       |
| 平板 | 192.168.1.4 | 203.0.113.5       |

三台机器都通过家里的路由器上网。

当你的电脑访问 `www.google.com` 时：

#### 通信过程

**步骤 1：电脑 → 路由器**

```
源 IP: 192.168.1.2
目的 IP: 142.250.72.14（Google）
```

**步骤 2：路由器执行 NAT 转换**

- 把源地址改成它的公网地址（203.0.113.5）
- 并分配一个临时端口号（例如 40001）

```
源 IP: 203.0.113.5:40001
目的 IP: 142.250.72.14:80
```

**步骤 3：路由器记录映射表**

```
NAT 表：
内网地址：192.168.1.2:12345 → 公网地址：203.0.113.5:40001
```

**步骤 4：返回数据时**

- Google 把数据发回 `203.0.113.5:40001`
- 路由器查 NAT 表，发现这是转给 `192.168.1.2:12345` 的
- 再改回私有地址，转发给电脑

整个过程对 Google 来说，就像只有一个设备（203.0.113.5）在访问它。

### 5. NAT 的类型

| 类型                    | 名称                                          | 说明                                                         |
| ----------------------- | --------------------------------------------- | ------------------------------------------------------------ |
| 静态 NAT                | Static NAT                                    | 一个内网 IP 永久映射到一个公网 IP（1 对 1）                  |
| 动态 NAT                | Dynamic NAT                                   | 从公网 IP 池中动态分配一个地址（1 对 N，动态变化）           |
| **PAT（端口地址转换）** | Port Address Translation（又称 NAT Overload） | 最常见！多个内网 IP 共用一个公网 IP，通过端口号区分（N 对 1） |

日常家用路由器采用的几乎都是 **PAT**。

### 6. NAT 的优点

✅ 节省公网 IP 地址

✅ 提高内部网络安全性（外部无法直接访问内网设备）

✅ 简化网络结构，允许自由使用私有 IP

### 7. NAT 的缺点

❌ 打破"端到端"通信模型（对某些协议不友好，比如 VoIP、P2P）

❌ 会导致需要额外机制（如 STUN/TURN/UPnP）才能穿透 NAT

❌ 不支持双向访问（外部无法主动访问内网设备）

例如：你在家里搭了一个 Web 服务器（192.168.1.2:80），外网的人无法直接访问它，因为 NAT 不知道该把外部请求转发给哪台内网主机。（除非设置端口映射/DMZ）

### 8. NAT 穿透与 IPv6 的关系

NAT 的广泛使用其实是因为 IPv4 地址短缺。IPv6 出现后，**每台设备都能分配一个全球唯一的 IPv6 地址**。所以在 IPv6 网络中：

理论上不再需要 NAT。

但现实中：

- 为兼容旧系统
- 或出于安全和隔离考虑
- 某些网络仍会保留 "NAT66"（IPv6 的 NAT 变种）

### 9. NAT 与路由器的关系

**NAT 通常由"路由器"实现。**

一个家庭宽带路由器实际上同时做两件事：

1. **路由**（决定数据去哪里）
2. **地址转换（NAT）**（修改 IP 地址）

你可以理解为：

**路由器 = NAT + 路由表 + 交换机 + DHCP 服务器**

### 10. NAT 总结

| 概念     | 含义                                | 举例                               |
| -------- | ----------------------------------- | ---------------------------------- |
| NAT      | 网络地址转换，用于节省公网 IP       | 家用路由器上网                     |
| 私有地址 | 内网使用的 IP，不可直接上网         | 192.168.x.x                        |
| 公网地址 | 全球唯一，可直连互联网              | 203.0.113.5                        |
| PAT      | 端口复用的 NAT，多设备共用一公网 IP | 192.168.1.x → 203.0.113.5:不同端口 |

------

## 第十部分：MAC 地址与 ARP 协议深入

### 1. MAC 地址基础

MAC 地址是网络设备的物理地址，用于在局域网中标识设备。每个网络设备的网卡都有一个唯一的 MAC 地址，它是硬件层面上的地址，常用于局域网中的通信。MAC 地址通常是由设备制造商在生产过程中分配的，不同于 IP 地址，MAC 地址与设备硬件绑定，并且在全球范围内是唯一的。

### 2. MAC 地址的作用

MAC 地址的作用简单来说就是：去标识设备，每个设备都有一个唯一的 MAC 地址，用来区分不同的设备。并且 MAC 地址能够帮助通信，MAC 地址能够确保设备在局域网中正确发送和接收数据。

### 3. MAC 地址与 IP 地址的区别

首先，MAC 地址工作在 OSI 模型的数据链路层，用于局域网内的通信，而 IP 地址工作在网络层，用于跨网络的通信。其次二者的工作范围也不同：MAC 地址用于本地网络中的设备通信，它唯一标识每个网卡设备；而 IP 地址是逻辑地址，用于在全球范围内识别设备，负责数据的路由和传输。而 MAC 地址由设备制造商在生产时分配，一旦分配基本不会改变；IP 地址通常由网络管理员或互联网服务提供商分配，可以是静态的，也可以是动态的，且可以根据网络连接更换。

### 4. 为什么既有 IP 地址还要 MAC 地址

在同一个局域网内，设备之间的通信必须依赖 MAC 地址。但我们通常只知道目标的 IP 地址，所以需要先通过 ARP 找到对应的 MAC 地址。

### 5. ARP 协议详解

#### ARP 协议的目的

ARP（Address Resolution Protocol）的作用是将 **IP 地址转换成 MAC 地址**。当你知道某个设备的 IP 地址，但不知道它的 MAC 地址时，就需要用 ARP 来查询。

#### 为什么需要 ARP

在同一个局域网内，设备之间的通信必须依赖 MAC 地址。但我们通常只知道目标的 IP 地址，所以需要先通过 ARP 找到对应的 MAC 地址。

#### ARP 的实际运行过程

假设你的电脑 IP 是 192.168.1.10，要 ping 一个同网络内的设备 192.168.1.20。步骤如下：

**步骤 1：电脑检查本地 ARP 缓存**

电脑先看看自己的 ARP 缓存表里有没有 192.168.1.20 对应的 MAC 地址。如果有，直接用；如果没有，继续。

**步骤 2：发送 ARP 请求（广播）**

电脑发送一个 ARP 请求包，以广播的形式发送到整个局域网。这个请求说："谁的 IP 是 192.168.1.20？请告诉我你的 MAC 地址。"这个请求包包含：

- 发送者 IP：192.168.1.10
- 发送者 MAC：你电脑的 MAC 地址（比如 AA:BB:CC:DD:EE:FF）
- 目标 IP：192.168.1.20
- 目标 MAC：未知（全是 0）

**步骤 3：局域网内所有设备收到请求**

因为是广播，该网络内的所有设备都会收到这个 ARP 请求。

**步骤 4：目标设备识别并回复**

拥有 192.168.1.20 这个 IP 的设备识别出"这是在问我"，就发送一个**单播 ARP 回复**给你的电脑，告诉你："我是 192.168.1.20，我的 MAC 地址是 11:22:33:44:55:66"。

**步骤 5：发起者收到回复并缓存**

你的电脑收到回复后，就知道了 192.168.1.20 对应的 MAC 是 11:22:33:44:55:66，并将这个映射关系存入自己的 ARP 缓存表中。

**步骤 6：现在可以通信**

电脑现在可以用这个 MAC 地址将数据包发送出去了。

#### ARP 完整示例

```
你的电脑（192.168.1.10，MAC: AA:BB:CC:DD:EE:FF）
要给 192.168.1.20 的设备发送数据

[广播] 谁是 192.168.1.20？
发送者：192.168.1.10 (AA:BB:CC:DD:EE:FF)
接收者：广播地址

→ 局域网所有设备都收到

[单播回复] 我是 192.168.1.20
我的 MAC：11:22:33:44:55:66

你的电脑收到回复
缓存：192.168.1.20 → 11:22:33:44:55:66

现在可以正常通信
```

#### ARP 缓存

电脑会将 ARP 查询结果存储一段时间（通常几分钟到几十分钟），这样就不用每次通信都重新查询。你可以在命令行用 `arp -a` 命令查看你的 ARP 缓存表。

#### ARP 的潜在问题

因为 ARP 是基于信任的协议，没有身份验证机制，所以容易受到 **ARP 欺骗/ARP 投毒** 攻击 — 恶意者可以伪造 ARP 回复，将某个 IP 地址的 MAC 地址指向自己，从而截获目标流量。

------

## 第十一部分：HTTP 状态码详解

### 1xx 信息性状态码（100-199）

**100 Continue**

客户端发送了带有 Expect: 100-continue 头的请求，服务器收到请求头后发送此状态码，告诉客户端可以继续发送请求体。这用于大文件上传时，客户端可以先验证服务器是否愿意接收。

**101 Switching Protocols**

服务器同意升级连接协议。例如从 HTTP 升级到 WebSocket 时，客户端发送 Upgrade 头，服务器回复 101 表示同意切换到 WebSocket 协议。

**102 Processing**

服务器正在处理请求，用于 WebDAV 操作，告诉客户端不要断开连接，处理还在进行中。

**103 Early Hints**

服务器可以在最终响应前发送此状态码，附带 Link 头来提示客户端预加载资源，加快页面加载速度。

### 2xx 成功状态码（200-299）

**200 OK**

请求成功，服务器返回了客户端请求的数据。这是最常见的成功响应，GET、POST 等请求成功时都会返回 200。

**201 Created**

请求成功并创建了新资源。通常用于 POST 请求创建新记录时，响应会包含 Location 头指向新创建资源的 URL，响应体通常包含新资源的详情。

**202 Accepted**

服务器已接受请求但还未处理。用于异步操作，比如上传视频进行转码，服务器立即返回 202，然后在后台处理。

**203 Non-Authoritative Information**

返回的信息来自第三方缓存或代理，而非原始服务器。这个状态码很少使用。

**204 No Content**

请求成功但服务器不返回任何内容。常用于 DELETE 请求删除资源成功，或 PUT 请求更新成功时。浏览器收到 204 后不会改变当前页面。

**205 Reset Content**

请求成功，要求客户端重置文档视图。比如提交表单后返回 205，浏览器会清空表单中的数据。

**206 Partial Content**

服务器返回了部分内容。用于支持断点续传和分片下载，响应会包含 Content-Range 头说明返回的内容范围。客户端可以通过 Range 请求头来请求特定范围的内容。

**207 Multi-Status**

响应体包含多个操作的状态信息，用于 WebDAV 操作返回多个资源的处理结果。

**208 Already Reported**

响应体中已经报告过该资源的状态，用于避免在 WebDAV 操作中重复报告相同资源的信息。

**226 IM Used**

服务器使用了 Instance Manipulations 完成了 GET 请求，这是 HTTP Delta encoding 的一部分，很少见。

### 3xx 重定向状态码（300-399）

**300 Multiple Choices**

请求的资源有多个可用选择，通常包含一个可用选项的列表。客户端需要选择其中一个。比如同一文件有多种格式可用时使用。

**301 Moved Permanently**

资源已永久移动到新 URL。浏览器和客户端会缓存这个重定向关系，以后访问旧 URL 时直接请求新 URL。搜索引擎会更新索引指向新 URL。

**302 Found**

资源临时移动到新位置。这次重定向不会被缓存，下次仍会先请求原 URL。注意 302 可能改变请求方法，比如 POST 变成 GET。

**303 See Other**

使用 GET 方法重定向到另一个 URL。通常在 POST 请求成功后用来重定向到结果页面，强制使用 GET 方法获取新资源。

**304 Not Modified**

客户端的缓存版本仍然有效。客户端发送了条件请求头（If-Modified-Since 或 If-None-Match），服务器验证资源未修改后返回 304，告诉客户端继续使用缓存。不会返回响应体。

**305 Use Proxy**

请求必须通过指定的代理进行。这个状态码已被弃用，现代浏览器出于安全考虑不再支持。

**307 Temporary Redirect**

资源临时移动到新 URL，但必须保持原请求方法。与 302 不同，307 保证 POST 请求仍然用 POST 方法重定向，而 302 可能改变方法。

**308 Permanent Redirect**

资源永久移动到新 URL，但必须保持原请求方法。与 301 不同，308 保证 POST 请求仍然用 POST 方法重定向，而 301 可能改变方法。

### 4xx 客户端错误状态码（400-499）

**400 Bad Request**

请求格式错误或参数无效，服务器无法理解请求。可能是请求头格式错误、参数类型不匹配、JSON 格式错误等。

**401 Unauthorized**

请求需要身份验证或身份验证失败。通常响应会包含 WWW-Authenticate 头指示认证方式。401 表示未提供凭证或凭证无效。

**402 Payment Required**

预留状态码，用于将来的数字支付系统，目前很少使用。

**403 Forbidden**

服务器理解请求但拒绝执行，用户没有访问权限。与 401 不同，403 表示已识别用户身份但无权访问。比如访问管理员面板但你不是管理员。

**404 Not Found**

请求的资源不存在。最常见的错误，表示 URL 对应的资源找不到。

**405 Method Not Allowed**

该资源不支持使用的 HTTP 方法。比如向只支持 GET 的资源发送 POST 请求会返回 405，响应会包含 Allow 头列出支持的方法。

**406 Not Acceptable**

服务器无法根据客户端的 Accept 头生成相应的响应。比如客户端只接受 JSON 格式但服务器只能返回 XML 时。

**407 Proxy Authentication Required**

必须使用代理进行身份验证。类似 401 但用于代理认证。

**408 Request Timeout**

请求超时。客户端在规定时间内没有完成请求，服务器关闭连接。

**409 Conflict**

请求与服务器的当前状态冲突。常见于更新操作，比如更新一个已被删除的资源，或并发更新导致版本冲突。

**410 Gone**

资源已永久删除且不会恢复。与 404 不同，410 表示资源曾存在但现在已移除。搜索引擎会停止索引该资源。

**411 Length Required**

服务器要求请求包含 Content-Length 头。很少现代服务器使用此状态码。

**412 Precondition Failed**

请求头中的前置条件不满足。比如使用 If-Match 头进行条件请求，但 ETag 不匹配时返回 412。

**413 Payload Too Large**

请求体过大，超过服务器允许的最大值。服务器可能会设置最大请求体大小限制。

**414 URI Too Long**

请求的 URI 过长。服务器对 URL 长度有限制时使用。

**415 Unsupported Media Type**

请求的 Content-Type 不被支持。比如上传文件类型不被允许时返回 415。

**416 Range Not Satisfiable**

请求的范围无法满足。比如使用 Range 头请求第 1000-2000 字节，但资源总共只有 500 字节时返回 416。

**417 Expectation Failed**

服务器无法满足 Expect 请求头的要求。比如客户端发送了 Expect: 100-continue 但服务器不支持。

**418 I'm a teapot**

这是一个愚人节彩蛋状态码，RFC 2324 定义的。网景浏览器曾在愚人节返回此状态码，现在某些服务器也会作为彩蛋返回。

**421 Misdirected Request**

请求被发送到了错误的服务器。在 HTTP/2 中，当客户端在错误的连接上发送请求时使用。

**422 Unprocessable Entity**

请求格式正确但包含语义错误。比如提交表单所有字段都有效但业务逻辑检查失败，如用户名已存在。

**423 Locked**

所请求的资源已被锁定。用于 WebDAV 中资源被另一个用户锁定的场景。

**424 Failed Dependency**

由于之前的请求失败，当前请求也失败了。用于 WebDAV 操作序列。

**425 Too Early**

服务器不愿意处理可能被重放的请求。用于 TLS 1.3 的 0-RTT 数据。

**426 Upgrade Required**

服务器要求升级到其他协议。比如必须使用 HTTPS 或 HTTP/2。

**428 Precondition Required**

服务器要求请求包含 If-Match 等前置条件头。用于防止并发修改问题。

**429 Too Many Requests**

用户在规定时间内发送了过多请求，被限流。响应通常包含 Retry-After 头告知何时可以重试。

**431 Request Header Fields Too Large**

请求头字段过大。比如 Cookie 值太大或自定义头过多。

**451 Unavailable For Legal Reasons**

由于法律原因资源无法访问。通常是被法院或政府禁止访问的内容。

### 5xx 服务器错误状态码（500-599）

**500 Internal Server Error**

服务器内部出现意外错误。这是最通用的服务器错误响应，表示服务器遇到了无法处理的情况，比如未捕获的异常、数据库连接失败等。

**501 Not Implemented**

服务器不支持该请求方法或功能。比如服务器不支持 PATCH 方法或某个特定功能尚未实现。

**502 Bad Gateway**

网关或代理服务器从上游服务器收到了无效响应。通常表示反向代理无法连接到后端服务器或收到了格式错误的响应。

**503 Service Unavailable**

服务器暂时无法处理请求，通常是因为维护、过载或故障。响应可能包含 Retry-After 头告知何时服务恢复。

**504 Gateway Timeout**

网关或代理在等待上游服务器响应时超时。通常表示后端服务器响应过慢或无法访问。

**505 HTTP Version Not Supported**

服务器不支持请求使用的 HTTP 协议版本。比如服务器只支持 HTTP/1.1 但收到 HTTP/3 请求。

**506 Variant Also Negotiates**

选择的资源配置有问题，导致透明内容协商陷入循环。很少见。

**507 Insufficient Storage**

服务器存储空间不足，无法完成请求。常见于 WebDAV 操作或文件上传。

**508 Loop Detected**

服务器检测到请求处理中出现无限循环。常见于 WebDAV 操作的循环引用。

**510 Not Extended**

服务器需要请求中的某个扩展才能完成处理。很少使用。

**511 Network Authentication Required**

客户端需要进行网络认证才能继续。常见于公共 WiFi 需要登录的场景。

### HTTP 状态码实际应用场景总结

**200 OK**

请求成功，服务器返回了你想要的数据。这是最常见的响应，任何正常的网页访问、API 调用成功都会返回 200。

**301/302**

页面重定向。301 是永久重定向（资源永久移动到新地址），302 是临时重定向（暂时在新地址）。访问一个网址被转到另一个网址时就是这两个状态码。

**304 Not Modified**

你的浏览器缓存还是新的，不需要重新下载。这节省了带宽和加载时间。

**400 Bad Request**

请求格式错误或参数有问题，服务器无法理解。这是客户端的错误。

**401 Unauthorized**

需要登录或身份验证失败。你还没提供凭证或凭证无效。

**403 Forbidden**

服务器理解你的请求但拒绝了，因为你没有权限。比如访问只有管理员能看的页面。

**404 Not Found**

你请求的资源不存在。是最常见的错误状态码，访问不存在的网页、API 端点都会返回 404。

**500 Internal Server Error**

服务器内部出错了。代码崩溃、数据库连接失败这类问题会返回 500。

**503 Service Unavailable**

服务器暂时无法服务，可能是在维护或过载。

------

## 第十二部分：HTTP 常用方法

### GET

获取资源。这是最常用的方法，用来请求服务器返回数据。GET 请求没有请求体，参数通过 URL 查询字符串传递。GET 请求是幂等的，多次请求返回相同结果，也是可缓存的。

### POST

提交数据创建资源。常用于提交表单、上传文件、创建新记录。POST 请求包含请求体，参数在请求体中。POST 不是幂等的，多次请求可能创建多个资源。

### PUT

完整替换资源。用来更新整个资源，需要在请求体中提供完整的资源数据。PUT 是幂等的，多次相同的 PUT 请求结果相同。

### PATCH

部分更新资源。用来修改资源的某些字段，只需要提供要修改的数据。PATCH 不一定是幂等的。

### DELETE

删除资源。用来删除服务器上的资源。DELETE 是幂等的，多次删除结果相同。

### HEAD

获取资源的元数据。类似 GET 但不返回响应体，只返回响应头。用来检查资源是否存在、获取文件大小等。

### OPTIONS

获取资源支持的方法。用来查询服务器支持哪些 HTTP 方法，也用于 CORS 预检请求。

### TRACE

追踪请求。用来调试，服务器会返回收到的请求。出于安全考虑现代浏览器通常禁用此方法。

### CONNECT

建立隧道连接。主要用于通过代理建立 HTTPS 连接。

### HTTP 方法的详细对比

#### POST 与 PUT 的区别

**POST** — 创建新资源。POST 请求会在服务器上创建一个新的资源，每次 POST 请求都可能产生不同的结果。比如你连续 POST 两次创建用户，会创建两个不同的用户。POST 不是幂等的，这意味着多次执行同一个 POST 请求会有不同的效果。

**PUT** — 完整替换资源。PUT 用来更新既有资源，需要在请求体中提供**完整的资源数据**。如果资源不存在，某些服务器会创建它。PUT 是幂等的，多次执行同一个 PUT 请求结果相同，因为每次都是用相同的数据完全替换资源。

#### POST 与 PATCH 的区别

**POST** — 创建新资源或执行动作。需要提交完整数据。

**PATCH** — 部分更新资源。PATCH 用来修改资源的**某些字段**，只需要提供要修改的数据，而不是完整的资源。PATCH 不一定是幂等的。
